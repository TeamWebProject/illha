<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <!-- head 내용은 여기에 위치합니다. -->
    <!-- ... -->

    <title>비밀번호찾기</title>
    <link rel="stylesheet" type="text/css" th:href="@{/bootstrap.min.css}">
    <style>
        h2 {
            text-align: center;
            font-size: 20px;
        }

        body {
            padding: 20px;
        }


        /* 간격을 조절하기 위해 body에 패딩을 추가합니다. */
    </style>
</head>
<body class="m-0 p-0">
<!-- 네비게이션 바 -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid p-0">
        <a class="navbar-brand" href="/">맛집리스트</a>
    </div>
</nav>
<!-- 비밀번호 찾기 폼 -->
<h2>비밀번호 찾기</h2>
<div class="container my-3 mx-auto">
    <form th:action="@{/member/findPassword}" method="post">
        <input type="hidden" name="verificationCodeSent" th:value="${verificationCodeSent}">
        <input type="hidden" name="verificationCode" th:value="${verificationCode}">
        <div class="mb-3">
            <div class="col-md-7 text-md-end">
                <label for="memberId" class="form-label">비밀번호를 찾으려는 아이디</label>
            </div>
            <div class="col-md-3 mx-auto">
                <input type="text" name="memberId" id="memberId" class="form-control" required
                       th:value="${memberId}">
            </div>
        </div>
        <!-- 추가: 비밀번호 찾기 버튼을 누르면 인증번호가 전송되면, 인증번호 입력란이 나타납니다. -->
        <div th:if="${verificationCodeSent}">
            <div class="mb-3">
                <div class="col-md-6 text-md-end" style="margin-left:25px;">
                    <label for="verificationCode" class="form-label">인증번호</label>
                </div>
                <div class="col-md-3 mx-auto">
                    <input type="password" name="inputVerificationCode" id="verificationCode" class="form-control"
                           required
                           th:value="${param.inputVerificationCode}">
                </div>
            </div>
        </div>
        <!-- 메시지를 표시하는 부분 -->
        <div th:if="${message}" class="row mt-3">
            <div class="col-md-12 text-center">
                <p th:text="${message}"></p>
            </div>
        </div>
        <div class="text-md-center">
            <button type="submit" class="btn btn-primary btn-lg w-25">다음</button>
        </div>
        <!-- 수정: 새로운 비밀번호 입력 폼 -->
    </form>
    <form th:action="@{/member/passwordReset}" method="post">
        <input type="hidden" name="memberId" th:value="${memberId}">
        <input type="hidden" name="verificationCode" th:value="${verificationCode}">
        <input type="hidden" name="verificationCodeValid" th:value="${verificationCodeValid}">
        <div th:if="${verificationCodeValid}">
            <div class="mb-3">
                <div class="col-md-12 text-center">
                    <label for="newPassword" class="form-label">새로운 비밀번호</label>
                </div>
                <div class="col-md-3 mx-auto">
                    <input type="password" name="newPassword" id="newPassword" class="form-control" required
                           th:value="${newPassword}">
                </div>
                <div class="col-md-12 text-center">
                    <label for="newPassword1" class="form-label">비밀번호 확인</label>
                </div>
                <div class="col-md-3 mx-auto">
                <input type="password" name="newPassword1" id="newPassword1" class="form-control" required
                       th:value="${newPassword1}">
                </div>
            </div>
            <!-- 비밀번호 확인 불일치 시 메시지를 표시 -->
            <div class="col-md-12 text-center" th:if="${not #strings.equals(newPassword, newPassword1)}">
                <p class="text-danger">비밀번호가 일치하지 않습니다.</p>
            </div>
            <div class="text-md-center">
                <button type="submit" class="btn btn-primary">비밀번호 재설정</button>
            </div>

        </div>
    </form>
</div>
</body>
<body>
    <!-- 추가: 비밀번호 재설정 성공 시 alert와 페이지 이동을 위한 스크립트 -->
    <script th:if="${param.resetSuccess}">
        console.log('스크립트 실행 확인');
        alert('비밀번호가 성공적으로 재설정되었습니다.');
           window.location.href = '/member/login';
    </script>
    <!-- 스크립트 실행 확인 및 메시지 보여주기 -->
    <script th:if="${showConfirmationScript}" th:inline="javascript">
        console.log('스크립트 실행 확인');
        var userEmail = /*[[@{${userEmail}}]]*/ '';

        function hideEmail(email) {
            var atIndex = email.indexOf('@');
            var dotIndex = email.lastIndexOf('.');

            // "@" 뒤의 첫 글자와 "." 이전의 모든 글자를 가려주는 방법
            var hiddenPart = email.charAt(atIndex + 1) + email.substring(atIndex + 2, dotIndex).replace(/./g, '*');

            return email.substring(0, atIndex + 1) + hiddenPart + email.substring(dotIndex);
        }

        var hiddenEmail = hideEmail(userEmail);

        alert('임시 비밀번호가 이메일로 전송되었습니다. 이메일을 확인해주세요.\n이메일: ' + hiddenEmail);
    </script>

</body>
</html>
